\hypertarget{precharge_discharge_8c}{}\doxysection{/\+Users/\+Richard/\+Documents/\+Waterloo/\+W\+F\+E/\+Code.nosync/2018\+\_\+bmu-\/2/\+Src/precharge\+Discharge.c File Reference}
\label{precharge_discharge_8c}\index{/Users/Richard/Documents/Waterloo/WFE/Code.nosync/2018\_bmu-\/2/Src/prechargeDischarge.c@{/Users/Richard/Documents/Waterloo/WFE/Code.nosync/2018\_bmu-\/2/Src/prechargeDischarge.c}}


Controls the precharge and dishcarge procedures of the HV bus.  


{\ttfamily \#include \char`\"{}precharge\+Discharge.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}control\+State\+Machine.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}Free\+R\+T\+O\+S.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}task.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}math.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}B\+M\+U\+\_\+dtc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}batteries.\+h\char`\"{}}\newline
Include dependency graph for precharge\+Discharge.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{precharge_discharge_8c_a69f54d0032197528845e3c70d2e0bc68}{E\+N\+A\+B\+L\+E\+\_\+\+P\+R\+E\+C\+H\+A\+R\+G\+E\+\_\+\+D\+I\+S\+C\+H\+A\+R\+GE}}
\item 
\#define \mbox{\hyperlink{precharge_discharge_8c_a8f9b3c758c866184895ab6f267f56f2a}{W\+A\+I\+T\+\_\+\+F\+O\+R\+\_\+\+N\+E\+X\+T\+\_\+\+M\+E\+A\+S\+U\+R\+E\+\_\+\+O\+R\+\_\+\+S\+T\+OP}}(Measure\+Period,  Notification\+Out)
\begin{DoxyCompactList}\small\item\em Delay measure period, and interrupt delay if receive notification. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Typedefs}
\begin{DoxyCompactItemize}
\item 
typedef enum \mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} \mbox{\hyperlink{precharge_discharge_8c_a3777552234c99ae105a60e1d276af4a8}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}}
\item 
typedef enum \mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}{Precharge\+\_\+\+Type\+\_\+t}} \mbox{\hyperlink{precharge_discharge_8c_a1819a0ea7cf7fe2cee5bab95287a589a}{Precharge\+\_\+\+Type\+\_\+t}}
\item 
typedef enum \mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}} \mbox{\hyperlink{precharge_discharge_8c_a6dc9cdbf0b2d1b0df080ab3db51ab32f}{Contactor\+State\+\_\+t}}
\end{DoxyCompactItemize}
\doxysubsection*{Enumerations}
\begin{DoxyCompactItemize}
\item 
enum \mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} \{ \mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a9e16b164a3957bef4ef78271f7017d8b}{P\+C\+D\+C\+\_\+\+D\+O\+NE}}, 
\mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a59acc94908f41ef74bec78bba4cb0aa7}{P\+C\+D\+C\+\_\+\+S\+T\+O\+P\+P\+ED}}, 
\mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a788f6ccccc3a6334cd4eca279b25ecbc}{P\+C\+D\+C\+\_\+\+E\+R\+R\+OR}}
 \}
\item 
enum \mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}{Precharge\+\_\+\+Type\+\_\+t}} \{ \mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69ada9b46c1ebd1fbdc6b0ad130e5c1a8da}{P\+C\+\_\+\+Motor\+Controllers}}, 
\mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69a6ae49cfd32f4809f78b0f9c95501983f}{P\+C\+\_\+\+Charger}}, 
\mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69ab0d2dd76d50c008cbbcb63b34284e1cd}{P\+C\+\_\+\+Num\+Types}}
 \}
\item 
enum \mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}} \{ \mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7a3f1a7d70a2aab523bed3023d4e2620cb}{C\+O\+N\+T\+A\+C\+T\+O\+R\+\_\+\+C\+L\+O\+S\+ED}} = G\+P\+I\+O\+\_\+\+P\+I\+N\+\_\+\+R\+E\+S\+ET, 
\mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7a2b30177bc521d6b4303e990208a5280f}{C\+O\+N\+T\+A\+C\+T\+O\+R\+\_\+\+O\+P\+EN}} = G\+P\+I\+O\+\_\+\+P\+I\+N\+\_\+\+S\+ET
 \}
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} \mbox{\hyperlink{precharge_discharge_8c_aeb4682e026fd4f795f52338469d54915}{discharge}} ()
\begin{DoxyCompactList}\small\item\em Discharges HV Bus. Opens contactors which connects in discharge resistor to discharge bus voltage. This function sends out a warning D\+TC, then waits (with timeout) for bus current to go to zero before opening contactors. This attempts to avoid opening contactors under load which can cause arcing/welding of contactors (very bad). \end{DoxyCompactList}\item 
H\+A\+L\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{precharge_discharge_8c_af2d764dbfb0dae00e4d9f8849c80bd7b}{pcdc\+Init}} ()
\item 
void \mbox{\hyperlink{precharge_discharge_8c_abff2f24b02adb053c98e9dab39e4bf8c}{set\+Neg\+Contactor}} (\mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}} state)
\begin{DoxyCompactList}\small\item\em Control negative contactor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{precharge_discharge_8c_a1cf8d9e41ce57c21a0cb0c8c3ed63dbc}{set\+Pos\+Contactor}} (\mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}} state)
\begin{DoxyCompactList}\small\item\em Control positive contactor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{precharge_discharge_8c_ae515fc0cfdab37834fe7288670ee1c9f}{set\+Precharge\+Contactor}} (\mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}} state)
\begin{DoxyCompactList}\small\item\em Control precharge discharge contactor. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{precharge_discharge_8c_a31e37b4f44b11e182256bff5c25df2ac}{open\+All\+Contactors}} ()
\begin{DoxyCompactList}\small\item\em Opens all contactors (safe state) \end{DoxyCompactList}\item 
H\+A\+L\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{precharge_discharge_8c_af98be4ce700b42b38a9f1126522cbd75}{update\+Measurements}} (float $\ast$V\+Bus, float $\ast$V\+Batt, float $\ast$I\+Bus)
\begin{DoxyCompactList}\small\item\em Update HV Bus measurements. \end{DoxyCompactList}\item 
\mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} \mbox{\hyperlink{precharge_discharge_8c_a7c67d24028b0fc2b67821ea9b0b55144}{precharge}} (\mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}{Precharge\+\_\+\+Type\+\_\+t}} precharge\+Type)
\begin{DoxyCompactList}\small\item\em Perform precharge. If succesful, bus voltage will equal battery voltage. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{precharge_discharge_8c_a65d178f293cd832dab02da08d5e86748}{pcdc\+Task}} (void $\ast$pv\+Parameter)
\begin{DoxyCompactList}\small\item\em Task to control precharge and discharge. Receives notifications from the control state machine to either precharge/discharge or stop precharge. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
bool \mbox{\hyperlink{precharge_discharge_8c_a9586edc6945922e1f2308286e7e0f42f}{H\+I\+T\+L\+\_\+\+Precharge\+\_\+\+Mode}} = false
\item 
float \mbox{\hyperlink{precharge_discharge_8c_a86492193b3825205acfee792b46c0f2d}{H\+I\+T\+L\+\_\+\+V\+P\+A\+CK}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Controls the precharge and dishcarge procedures of the HV bus. 

\begin{DoxyAuthor}{Author}
Richard Matthews
\end{DoxyAuthor}
The precharge and discharge procedure is repsonsible for safely connecting and disconnecting the HV battery pack from the motor controllers. It is controlled by the precharge discharge task (pcdc\+Task). The main control state machine initiates precharge and discharge by sending a notification to the pcdc\+Task, and discharge is initiated by the state machine in the case of errors. 

\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{precharge_discharge_8c_a69f54d0032197528845e3c70d2e0bc68}\label{precharge_discharge_8c_a69f54d0032197528845e3c70d2e0bc68}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!ENABLE\_PRECHARGE\_DISCHARGE@{ENABLE\_PRECHARGE\_DISCHARGE}}
\index{ENABLE\_PRECHARGE\_DISCHARGE@{ENABLE\_PRECHARGE\_DISCHARGE}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{ENABLE\_PRECHARGE\_DISCHARGE}{ENABLE\_PRECHARGE\_DISCHARGE}}
{\footnotesize\ttfamily \#define E\+N\+A\+B\+L\+E\+\_\+\+P\+R\+E\+C\+H\+A\+R\+G\+E\+\_\+\+D\+I\+S\+C\+H\+A\+R\+GE}

\mbox{\Hypertarget{precharge_discharge_8c_a8f9b3c758c866184895ab6f267f56f2a}\label{precharge_discharge_8c_a8f9b3c758c866184895ab6f267f56f2a}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!WAIT\_FOR\_NEXT\_MEASURE\_OR\_STOP@{WAIT\_FOR\_NEXT\_MEASURE\_OR\_STOP}}
\index{WAIT\_FOR\_NEXT\_MEASURE\_OR\_STOP@{WAIT\_FOR\_NEXT\_MEASURE\_OR\_STOP}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{WAIT\_FOR\_NEXT\_MEASURE\_OR\_STOP}{WAIT\_FOR\_NEXT\_MEASURE\_OR\_STOP}}
{\footnotesize\ttfamily \#define W\+A\+I\+T\+\_\+\+F\+O\+R\+\_\+\+N\+E\+X\+T\+\_\+\+M\+E\+A\+S\+U\+R\+E\+\_\+\+O\+R\+\_\+\+S\+T\+OP(\begin{DoxyParamCaption}\item[{}]{Measure\+Period,  }\item[{}]{Notification\+Out }\end{DoxyParamCaption})}

{\bfseries Value\+:}
\begin{DoxyCode}{0}
\DoxyCodeLine{    \textcolor{keywordflow}{do} \{ \(\backslash\)}
\DoxyCodeLine{        NotificationOut = 0; \textcolor{comment}{/* Set to zero, in case no notifaction received */} \(\backslash\)}
\DoxyCodeLine{        xTaskNotifyWait( 0x00,       \textcolor{comment}{/* Don't clear any notification bits on entry. */} \(\backslash\)}
\DoxyCodeLine{                         UINT32\_MAX, \textcolor{comment}{/* Reset the notification value to 0 on exit. */} \(\backslash\)}
\DoxyCodeLine{                         \&NotificationOut, \textcolor{comment}{/* Notified value passed out */} \(\backslash\)}
\DoxyCodeLine{                         pdMS\_TO\_TICKS(MeasurePeriod)); \textcolor{comment}{/* Timeout */} \(\backslash\)}
\DoxyCodeLine{    \} \textcolor{keywordflow}{while}(0)}

\end{DoxyCode}


Delay measure period, and interrupt delay if receive notification. 


\begin{DoxyParams}{Parameters}
{\em Measure\+Period} & The period to delay for \\
\hline
{\em Notification\+Out} & The returned notification value \\
\hline
\end{DoxyParams}


\doxysubsection{Typedef Documentation}
\mbox{\Hypertarget{precharge_discharge_8c_a6dc9cdbf0b2d1b0df080ab3db51ab32f}\label{precharge_discharge_8c_a6dc9cdbf0b2d1b0df080ab3db51ab32f}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!ContactorState\_t@{ContactorState\_t}}
\index{ContactorState\_t@{ContactorState\_t}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{ContactorState\_t}{ContactorState\_t}}
{\footnotesize\ttfamily typedef enum \mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}} \mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}}}

Enum to translate between contactor open/closed and G\+P\+IO pin state \mbox{\Hypertarget{precharge_discharge_8c_a3777552234c99ae105a60e1d276af4a8}\label{precharge_discharge_8c_a3777552234c99ae105a60e1d276af4a8}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!Precharge\_Discharge\_Return\_t@{Precharge\_Discharge\_Return\_t}}
\index{Precharge\_Discharge\_Return\_t@{Precharge\_Discharge\_Return\_t}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{Precharge\_Discharge\_Return\_t}{Precharge\_Discharge\_Return\_t}}
{\footnotesize\ttfamily typedef enum \mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} \mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}}}

Return types for precharge and discharge functions \mbox{\Hypertarget{precharge_discharge_8c_a1819a0ea7cf7fe2cee5bab95287a589a}\label{precharge_discharge_8c_a1819a0ea7cf7fe2cee5bab95287a589a}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!Precharge\_Type\_t@{Precharge\_Type\_t}}
\index{Precharge\_Type\_t@{Precharge\_Type\_t}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{Precharge\_Type\_t}{Precharge\_Type\_t}}
{\footnotesize\ttfamily typedef enum \mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}{Precharge\+\_\+\+Type\+\_\+t}} \mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}{Precharge\+\_\+\+Type\+\_\+t}}}

Type of precharge to perform. This changes the checks performed during precharge, due to different capacitance of motor controllers and chargers. See B\+MU confluence for more details 

\doxysubsection{Enumeration Type Documentation}
\mbox{\Hypertarget{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}\label{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!ContactorState\_t@{ContactorState\_t}}
\index{ContactorState\_t@{ContactorState\_t}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{ContactorState\_t}{ContactorState\_t}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}}}

Enum to translate between contactor open/closed and G\+P\+IO pin state \begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{CONTACTOR\_CLOSED@{CONTACTOR\_CLOSED}!prechargeDischarge.c@{prechargeDischarge.c}}\index{prechargeDischarge.c@{prechargeDischarge.c}!CONTACTOR\_CLOSED@{CONTACTOR\_CLOSED}}}\mbox{\Hypertarget{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7a3f1a7d70a2aab523bed3023d4e2620cb}\label{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7a3f1a7d70a2aab523bed3023d4e2620cb}} 
C\+O\+N\+T\+A\+C\+T\+O\+R\+\_\+\+C\+L\+O\+S\+ED&\\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{CONTACTOR\_OPEN@{CONTACTOR\_OPEN}!prechargeDischarge.c@{prechargeDischarge.c}}\index{prechargeDischarge.c@{prechargeDischarge.c}!CONTACTOR\_OPEN@{CONTACTOR\_OPEN}}}\mbox{\Hypertarget{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7a2b30177bc521d6b4303e990208a5280f}\label{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7a2b30177bc521d6b4303e990208a5280f}} 
C\+O\+N\+T\+A\+C\+T\+O\+R\+\_\+\+O\+P\+EN&\\
\hline

\end{DoxyEnumFields}
\mbox{\Hypertarget{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}\label{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!Precharge\_Discharge\_Return\_t@{Precharge\_Discharge\_Return\_t}}
\index{Precharge\_Discharge\_Return\_t@{Precharge\_Discharge\_Return\_t}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{Precharge\_Discharge\_Return\_t}{Precharge\_Discharge\_Return\_t}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}}}

Return types for precharge and discharge functions \begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{PCDC\_DONE@{PCDC\_DONE}!prechargeDischarge.c@{prechargeDischarge.c}}\index{prechargeDischarge.c@{prechargeDischarge.c}!PCDC\_DONE@{PCDC\_DONE}}}\mbox{\Hypertarget{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a9e16b164a3957bef4ef78271f7017d8b}\label{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a9e16b164a3957bef4ef78271f7017d8b}} 
P\+C\+D\+C\+\_\+\+D\+O\+NE&Precharge/\+Discharge completed. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{PCDC\_STOPPED@{PCDC\_STOPPED}!prechargeDischarge.c@{prechargeDischarge.c}}\index{prechargeDischarge.c@{prechargeDischarge.c}!PCDC\_STOPPED@{PCDC\_STOPPED}}}\mbox{\Hypertarget{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a59acc94908f41ef74bec78bba4cb0aa7}\label{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a59acc94908f41ef74bec78bba4cb0aa7}} 
P\+C\+D\+C\+\_\+\+S\+T\+O\+P\+P\+ED&Precharge/\+Discharge stopped succesfully (as requested by task notification) \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{PCDC\_ERROR@{PCDC\_ERROR}!prechargeDischarge.c@{prechargeDischarge.c}}\index{prechargeDischarge.c@{prechargeDischarge.c}!PCDC\_ERROR@{PCDC\_ERROR}}}\mbox{\Hypertarget{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a788f6ccccc3a6334cd4eca279b25ecbc}\label{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5a788f6ccccc3a6334cd4eca279b25ecbc}} 
P\+C\+D\+C\+\_\+\+E\+R\+R\+OR&Error occured during Precharge/\+Discharge. \\
\hline

\end{DoxyEnumFields}
\mbox{\Hypertarget{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}\label{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!Precharge\_Type\_t@{Precharge\_Type\_t}}
\index{Precharge\_Type\_t@{Precharge\_Type\_t}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{Precharge\_Type\_t}{Precharge\_Type\_t}}
{\footnotesize\ttfamily enum \mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}{Precharge\+\_\+\+Type\+\_\+t}}}

Type of precharge to perform. This changes the checks performed during precharge, due to different capacitance of motor controllers and chargers. See B\+MU confluence for more details \begin{DoxyEnumFields}{Enumerator}
\raisebox{\heightof{T}}[0pt][0pt]{\index{PC\_MotorControllers@{PC\_MotorControllers}!prechargeDischarge.c@{prechargeDischarge.c}}\index{prechargeDischarge.c@{prechargeDischarge.c}!PC\_MotorControllers@{PC\_MotorControllers}}}\mbox{\Hypertarget{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69ada9b46c1ebd1fbdc6b0ad130e5c1a8da}\label{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69ada9b46c1ebd1fbdc6b0ad130e5c1a8da}} 
P\+C\+\_\+\+Motor\+Controllers&Precharge motor controllers. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{PC\_Charger@{PC\_Charger}!prechargeDischarge.c@{prechargeDischarge.c}}\index{prechargeDischarge.c@{prechargeDischarge.c}!PC\_Charger@{PC\_Charger}}}\mbox{\Hypertarget{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69a6ae49cfd32f4809f78b0f9c95501983f}\label{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69a6ae49cfd32f4809f78b0f9c95501983f}} 
P\+C\+\_\+\+Charger&Precharge charger. \\
\hline

\raisebox{\heightof{T}}[0pt][0pt]{\index{PC\_NumTypes@{PC\_NumTypes}!prechargeDischarge.c@{prechargeDischarge.c}}\index{prechargeDischarge.c@{prechargeDischarge.c}!PC\_NumTypes@{PC\_NumTypes}}}\mbox{\Hypertarget{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69ab0d2dd76d50c008cbbcb63b34284e1cd}\label{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69ab0d2dd76d50c008cbbcb63b34284e1cd}} 
P\+C\+\_\+\+Num\+Types&\\
\hline

\end{DoxyEnumFields}


\doxysubsection{Function Documentation}
\mbox{\Hypertarget{precharge_discharge_8c_aeb4682e026fd4f795f52338469d54915}\label{precharge_discharge_8c_aeb4682e026fd4f795f52338469d54915}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!discharge@{discharge}}
\index{discharge@{discharge}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{discharge()}{discharge()}}
{\footnotesize\ttfamily \mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} discharge (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Discharges HV Bus. Opens contactors which connects in discharge resistor to discharge bus voltage. This function sends out a warning D\+TC, then waits (with timeout) for bus current to go to zero before opening contactors. This attempts to avoid opening contactors under load which can cause arcing/welding of contactors (very bad). 

\begin{DoxyReturn}{Returns}
\mbox{\hyperlink{precharge_discharge_8c_a3777552234c99ae105a60e1d276af4a8}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} 
\end{DoxyReturn}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c_aeb4682e026fd4f795f52338469d54915_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=329pt]{precharge_discharge_8c_aeb4682e026fd4f795f52338469d54915_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{precharge_discharge_8c_a31e37b4f44b11e182256bff5c25df2ac}\label{precharge_discharge_8c_a31e37b4f44b11e182256bff5c25df2ac}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!openAllContactors@{openAllContactors}}
\index{openAllContactors@{openAllContactors}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{openAllContactors()}{openAllContactors()}}
{\footnotesize\ttfamily void open\+All\+Contactors (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}



Opens all contactors (safe state) 

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=330pt]{precharge_discharge_8c_a31e37b4f44b11e182256bff5c25df2ac_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c_a31e37b4f44b11e182256bff5c25df2ac_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{precharge_discharge_8c_af2d764dbfb0dae00e4d9f8849c80bd7b}\label{precharge_discharge_8c_af2d764dbfb0dae00e4d9f8849c80bd7b}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!pcdcInit@{pcdcInit}}
\index{pcdcInit@{pcdcInit}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{pcdcInit()}{pcdcInit()}}
{\footnotesize\ttfamily H\+A\+L\+\_\+\+Status\+Type\+Def pcdc\+Init (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=226pt]{precharge_discharge_8c_af2d764dbfb0dae00e4d9f8849c80bd7b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{precharge_discharge_8c_a65d178f293cd832dab02da08d5e86748}\label{precharge_discharge_8c_a65d178f293cd832dab02da08d5e86748}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!pcdcTask@{pcdcTask}}
\index{pcdcTask@{pcdcTask}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{pcdcTask()}{pcdcTask()}}
{\footnotesize\ttfamily void pcdc\+Task (\begin{DoxyParamCaption}\item[{void $\ast$}]{pv\+Parameter }\end{DoxyParamCaption})}



Task to control precharge and discharge. Receives notifications from the control state machine to either precharge/discharge or stop precharge. 

Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c_a65d178f293cd832dab02da08d5e86748_cgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{precharge_discharge_8c_a7c67d24028b0fc2b67821ea9b0b55144}\label{precharge_discharge_8c_a7c67d24028b0fc2b67821ea9b0b55144}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!precharge@{precharge}}
\index{precharge@{precharge}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{precharge()}{precharge()}}
{\footnotesize\ttfamily \mbox{\hyperlink{precharge_discharge_8c_aea79df947f854aa51fdc586c2c8d97f5}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} precharge (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69}{Precharge\+\_\+\+Type\+\_\+t}}}]{precharge\+Type }\end{DoxyParamCaption})}



Perform precharge. If succesful, bus voltage will equal battery voltage. 


\begin{DoxyParams}{Parameters}
{\em precharge\+Type} & \mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69ada9b46c1ebd1fbdc6b0ad130e5c1a8da}{P\+C\+\_\+\+Motor\+Controllers}} precharges into motor controllers, so assumes a high capacitance and therefore precharge current. \mbox{\hyperlink{precharge_discharge_8c_a17b0022b8742c7c348c6ee58af55fc69a6ae49cfd32f4809f78b0f9c95501983f}{P\+C\+\_\+\+Charger}} precharges into the charger, so assumes a low capacitance and therefore negligible current\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
\mbox{\hyperlink{precharge_discharge_8c_a3777552234c99ae105a60e1d276af4a8}{Precharge\+\_\+\+Discharge\+\_\+\+Return\+\_\+t}} 
\end{DoxyReturn}
Here is the call graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c_a7c67d24028b0fc2b67821ea9b0b55144_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=234pt]{precharge_discharge_8c_a7c67d24028b0fc2b67821ea9b0b55144_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{precharge_discharge_8c_abff2f24b02adb053c98e9dab39e4bf8c}\label{precharge_discharge_8c_abff2f24b02adb053c98e9dab39e4bf8c}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!setNegContactor@{setNegContactor}}
\index{setNegContactor@{setNegContactor}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{setNegContactor()}{setNegContactor()}}
{\footnotesize\ttfamily void set\+Neg\+Contactor (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}}}]{state }\end{DoxyParamCaption})}



Control negative contactor. 


\begin{DoxyParams}{Parameters}
{\em state} & The state to set contactor to \\
\hline
\end{DoxyParams}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c_abff2f24b02adb053c98e9dab39e4bf8c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{precharge_discharge_8c_a1cf8d9e41ce57c21a0cb0c8c3ed63dbc}\label{precharge_discharge_8c_a1cf8d9e41ce57c21a0cb0c8c3ed63dbc}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!setPosContactor@{setPosContactor}}
\index{setPosContactor@{setPosContactor}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{setPosContactor()}{setPosContactor()}}
{\footnotesize\ttfamily void set\+Pos\+Contactor (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}}}]{state }\end{DoxyParamCaption})}



Control positive contactor. 


\begin{DoxyParams}{Parameters}
{\em state} & The state to set contactor to \\
\hline
\end{DoxyParams}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c_a1cf8d9e41ce57c21a0cb0c8c3ed63dbc_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{precharge_discharge_8c_ae515fc0cfdab37834fe7288670ee1c9f}\label{precharge_discharge_8c_ae515fc0cfdab37834fe7288670ee1c9f}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!setPrechargeContactor@{setPrechargeContactor}}
\index{setPrechargeContactor@{setPrechargeContactor}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{setPrechargeContactor()}{setPrechargeContactor()}}
{\footnotesize\ttfamily void set\+Precharge\+Contactor (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{precharge_discharge_8c_a25149a5b048ac873c80edeabc0e1ace7}{Contactor\+State\+\_\+t}}}]{state }\end{DoxyParamCaption})}



Control precharge discharge contactor. 


\begin{DoxyParams}{Parameters}
{\em state} & The state to set contactor to. Note for P\+C\+DC contactor closed means precharge mode, open means discharge mode \\
\hline
\end{DoxyParams}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c_ae515fc0cfdab37834fe7288670ee1c9f_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{precharge_discharge_8c_af98be4ce700b42b38a9f1126522cbd75}\label{precharge_discharge_8c_af98be4ce700b42b38a9f1126522cbd75}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!updateMeasurements@{updateMeasurements}}
\index{updateMeasurements@{updateMeasurements}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{updateMeasurements()}{updateMeasurements()}}
{\footnotesize\ttfamily H\+A\+L\+\_\+\+Status\+Type\+Def update\+Measurements (\begin{DoxyParamCaption}\item[{float $\ast$}]{V\+Bus,  }\item[{float $\ast$}]{V\+Batt,  }\item[{float $\ast$}]{I\+Bus }\end{DoxyParamCaption})}



Update HV Bus measurements. 


\begin{DoxyParams}[1]{Parameters}
\mbox{\texttt{ out}}  & {\em V\+Bus} & pointer to float to store HV Bus voltage measurement in volts \\
\hline
\mbox{\texttt{ out}}  & {\em V\+Batt} & pointer to float to store HV Battery voltage measurement in volts \\
\hline
\mbox{\texttt{ out}}  & {\em I\+Bus} & pointer to float to store HV Bus current measurement in amps\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
H\+A\+L\+\_\+\+Status\+Type\+Def 
\end{DoxyReturn}
Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=281pt]{precharge_discharge_8c_af98be4ce700b42b38a9f1126522cbd75_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{precharge_discharge_8c_af98be4ce700b42b38a9f1126522cbd75_icgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{precharge_discharge_8c_a9586edc6945922e1f2308286e7e0f42f}\label{precharge_discharge_8c_a9586edc6945922e1f2308286e7e0f42f}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!HITL\_Precharge\_Mode@{HITL\_Precharge\_Mode}}
\index{HITL\_Precharge\_Mode@{HITL\_Precharge\_Mode}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{HITL\_Precharge\_Mode}{HITL\_Precharge\_Mode}}
{\footnotesize\ttfamily bool H\+I\+T\+L\+\_\+\+Precharge\+\_\+\+Mode = false}

\mbox{\Hypertarget{precharge_discharge_8c_a86492193b3825205acfee792b46c0f2d}\label{precharge_discharge_8c_a86492193b3825205acfee792b46c0f2d}} 
\index{prechargeDischarge.c@{prechargeDischarge.c}!HITL\_VPACK@{HITL\_VPACK}}
\index{HITL\_VPACK@{HITL\_VPACK}!prechargeDischarge.c@{prechargeDischarge.c}}
\doxysubsubsection{\texorpdfstring{HITL\_VPACK}{HITL\_VPACK}}
{\footnotesize\ttfamily float H\+I\+T\+L\+\_\+\+V\+P\+A\+CK = 0}

