\hypertarget{imd_driver_8c}{}\doxysection{/\+Users/\+Richard/\+Documents/\+Waterloo/\+W\+F\+E/\+Code.nosync/2018\+\_\+bmu-\/2/\+Src/\+F7\+\_\+\+Src/imd\+Driver.c File Reference}
\label{imd_driver_8c}\index{/Users/Richard/Documents/Waterloo/WFE/Code.nosync/2018\_bmu-\/2/Src/F7\_Src/imdDriver.c@{/Users/Richard/Documents/Waterloo/WFE/Code.nosync/2018\_bmu-\/2/Src/F7\_Src/imdDriver.c}}


Module containing functions to read I\+MD status.  


{\ttfamily \#include \char`\"{}imd\+Driver.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bsp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}B\+M\+U\+\_\+dtc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}state\+\_\+machine.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}control\+State\+Machine.\+h\char`\"{}}\newline
Include dependency graph for imd\+Driver.\+c\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{imd_driver_8c__incl}
\end{center}
\end{figure}
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{imd_driver_8c_a42017d849e45c764948b04484eb8c00b}{I\+M\+D\+\_\+\+S\+E\+N\+S\+E\+\_\+\+P\+I\+N\+\_\+\+F\+A\+U\+LT}}~G\+P\+I\+O\+\_\+\+P\+I\+N\+\_\+\+R\+E\+S\+ET
\item 
\#define \mbox{\hyperlink{imd_driver_8c_a8f0f5b9d61f1fe2abcb9e93826e14d95}{I\+M\+D\+\_\+\+S\+E\+N\+S\+E\+\_\+\+P\+I\+N\+\_\+\+N\+O\+\_\+\+F\+A\+U\+LT}}~G\+P\+I\+O\+\_\+\+P\+I\+N\+\_\+\+S\+ET
\item 
\#define \mbox{\hyperlink{imd_driver_8c_a0a2c7de4cb34f5967b2394c632782abc}{I\+M\+D\+\_\+\+F\+R\+E\+Q\+\_\+\+M\+E\+A\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T\+\_\+\+MS}}~200
\item 
\#define \mbox{\hyperlink{imd_driver_8c_ae13157c0dc47d315b5fa8a3e2d874625}{I\+M\+D\+\_\+\+T\+I\+M\+E\+R\+\_\+\+T\+I\+C\+K\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y\+\_\+\+HZ}}~50000
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
static void \mbox{\hyperlink{imd_driver_8c_af1f048b39ad5d1c58fedb14d8b71ceac}{print\+\_\+error}} (char err\mbox{[}$\,$\mbox{]})
\item 
H\+A\+L\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{imd_driver_8c_a6f3d9bbe5a82521876f77eb2060be41b}{init\+\_\+imd\+\_\+measurement}} (void)
\item 
H\+A\+L\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{imd_driver_8c_ac32ede0a3ccf3e67a68ecf2610a5f27a}{begin\+\_\+imd\+\_\+measurement}} (void)
\item 
H\+A\+L\+\_\+\+Status\+Type\+Def \mbox{\hyperlink{imd_driver_8c_a6d65575764f3cb021f84c20bee19f7ef}{stop\+\_\+imd\+\_\+measurement}} (void)
\item 
\mbox{\hyperlink{struct_i_m_d_measurements}{I\+M\+D\+Measurements}} \mbox{\hyperlink{imd_driver_8c_aebd1c3b62e54f80fde0f344a7544f44f}{get\+\_\+imd\+\_\+measurements}} (void)
\item 
\mbox{\hyperlink{imd_driver_8h_a9f01a176f9de4b760a320dd1a107f598}{I\+M\+D\+Status}} \mbox{\hyperlink{imd_driver_8c_ae7c47b247d60f019398ac13248a4e13d}{\+\_\+imd\+\_\+status}} (uint32\+\_\+t freq\+\_\+m\+Hz, uint32\+\_\+t duty)
\item 
\mbox{\hyperlink{imd_driver_8h_a9f01a176f9de4b760a320dd1a107f598}{I\+M\+D\+Status}} \mbox{\hyperlink{imd_driver_8c_a9604fac4bed1c3a28bad1e6be5c7f62c}{get\+\_\+imd\+\_\+status}} ()
\item 
void \mbox{\hyperlink{imd_driver_8c_a77a2401a35ddd9bd0b8fc28331b81381}{H\+A\+L\+\_\+\+T\+I\+M\+\_\+\+I\+C\+\_\+\+Capture\+Callback}} (T\+I\+M\+\_\+\+Handle\+Type\+Def $\ast$htim)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
volatile uint32\+\_\+t \mbox{\hyperlink{imd_driver_8c_adff46a5e26f9ece00b19c43e77d737e2}{meas\+\_\+\+I\+C2\+\_\+val}} = 0
\item 
volatile uint32\+\_\+t \mbox{\hyperlink{imd_driver_8c_aa10b9b26d734a2ce24fac2f5c7540bac}{meas\+\_\+\+I\+C1\+\_\+val}} = 0
\item 
volatile uint32\+\_\+t \mbox{\hyperlink{imd_driver_8c_a2f62b9d23e2baf44cf78109e27289a22}{meas\+\_\+duty\+\_\+cycle}} = 0
\item 
volatile uint32\+\_\+t \mbox{\hyperlink{imd_driver_8c_adfbfd73fa35cf39e4b29bf320b58abb7}{meas\+\_\+freq\+\_\+m\+Hz}} = 0
\item 
volatile uint32\+\_\+t \mbox{\hyperlink{imd_driver_8c_af81aa17671bf683054a54703a454a1ba}{last\+Capture\+Time\+Ticks}} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Module containing functions to read I\+MD status. 

\begin{DoxyAuthor}{Author}
Richard Matthews
\end{DoxyAuthor}
The I\+MD (Bender I\+R155-\/3203/3204) is an insulation monitoring device which monitors the resistance between the HV Bus and the chassis ground. It reports a fault if the insulation drop below a certain value. The I\+MD communicates with the B\+MU through a gpio pin indicating a boolean fault status (OK or F\+A\+IL) and a P\+WM signal indicating the fault type. 

\doxysubsection{Macro Definition Documentation}
\mbox{\Hypertarget{imd_driver_8c_a0a2c7de4cb34f5967b2394c632782abc}\label{imd_driver_8c_a0a2c7de4cb34f5967b2394c632782abc}} 
\index{imdDriver.c@{imdDriver.c}!IMD\_FREQ\_MEAS\_TIMEOUT\_MS@{IMD\_FREQ\_MEAS\_TIMEOUT\_MS}}
\index{IMD\_FREQ\_MEAS\_TIMEOUT\_MS@{IMD\_FREQ\_MEAS\_TIMEOUT\_MS}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{IMD\_FREQ\_MEAS\_TIMEOUT\_MS}{IMD\_FREQ\_MEAS\_TIMEOUT\_MS}}
{\footnotesize\ttfamily \#define I\+M\+D\+\_\+\+F\+R\+E\+Q\+\_\+\+M\+E\+A\+S\+\_\+\+T\+I\+M\+E\+O\+U\+T\+\_\+\+MS~200}

\mbox{\Hypertarget{imd_driver_8c_a42017d849e45c764948b04484eb8c00b}\label{imd_driver_8c_a42017d849e45c764948b04484eb8c00b}} 
\index{imdDriver.c@{imdDriver.c}!IMD\_SENSE\_PIN\_FAULT@{IMD\_SENSE\_PIN\_FAULT}}
\index{IMD\_SENSE\_PIN\_FAULT@{IMD\_SENSE\_PIN\_FAULT}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{IMD\_SENSE\_PIN\_FAULT}{IMD\_SENSE\_PIN\_FAULT}}
{\footnotesize\ttfamily \#define I\+M\+D\+\_\+\+S\+E\+N\+S\+E\+\_\+\+P\+I\+N\+\_\+\+F\+A\+U\+LT~G\+P\+I\+O\+\_\+\+P\+I\+N\+\_\+\+R\+E\+S\+ET}

\mbox{\Hypertarget{imd_driver_8c_a8f0f5b9d61f1fe2abcb9e93826e14d95}\label{imd_driver_8c_a8f0f5b9d61f1fe2abcb9e93826e14d95}} 
\index{imdDriver.c@{imdDriver.c}!IMD\_SENSE\_PIN\_NO\_FAULT@{IMD\_SENSE\_PIN\_NO\_FAULT}}
\index{IMD\_SENSE\_PIN\_NO\_FAULT@{IMD\_SENSE\_PIN\_NO\_FAULT}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{IMD\_SENSE\_PIN\_NO\_FAULT}{IMD\_SENSE\_PIN\_NO\_FAULT}}
{\footnotesize\ttfamily \#define I\+M\+D\+\_\+\+S\+E\+N\+S\+E\+\_\+\+P\+I\+N\+\_\+\+N\+O\+\_\+\+F\+A\+U\+LT~G\+P\+I\+O\+\_\+\+P\+I\+N\+\_\+\+S\+ET}

\mbox{\Hypertarget{imd_driver_8c_ae13157c0dc47d315b5fa8a3e2d874625}\label{imd_driver_8c_ae13157c0dc47d315b5fa8a3e2d874625}} 
\index{imdDriver.c@{imdDriver.c}!IMD\_TIMER\_TICK\_FREQUENCY\_HZ@{IMD\_TIMER\_TICK\_FREQUENCY\_HZ}}
\index{IMD\_TIMER\_TICK\_FREQUENCY\_HZ@{IMD\_TIMER\_TICK\_FREQUENCY\_HZ}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{IMD\_TIMER\_TICK\_FREQUENCY\_HZ}{IMD\_TIMER\_TICK\_FREQUENCY\_HZ}}
{\footnotesize\ttfamily \#define I\+M\+D\+\_\+\+T\+I\+M\+E\+R\+\_\+\+T\+I\+C\+K\+\_\+\+F\+R\+E\+Q\+U\+E\+N\+C\+Y\+\_\+\+HZ~50000}



\doxysubsection{Function Documentation}
\mbox{\Hypertarget{imd_driver_8c_ae7c47b247d60f019398ac13248a4e13d}\label{imd_driver_8c_ae7c47b247d60f019398ac13248a4e13d}} 
\index{imdDriver.c@{imdDriver.c}!\_imd\_status@{\_imd\_status}}
\index{\_imd\_status@{\_imd\_status}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{\_imd\_status()}{\_imd\_status()}}
{\footnotesize\ttfamily \mbox{\hyperlink{imd_driver_8h_a9f01a176f9de4b760a320dd1a107f598}{I\+M\+D\+Status}} \+\_\+imd\+\_\+status (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{freq\+\_\+m\+Hz,  }\item[{uint32\+\_\+t}]{duty }\end{DoxyParamCaption})}

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{imd_driver_8c_ae7c47b247d60f019398ac13248a4e13d_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{imd_driver_8c_ac32ede0a3ccf3e67a68ecf2610a5f27a}\label{imd_driver_8c_ac32ede0a3ccf3e67a68ecf2610a5f27a}} 
\index{imdDriver.c@{imdDriver.c}!begin\_imd\_measurement@{begin\_imd\_measurement}}
\index{begin\_imd\_measurement@{begin\_imd\_measurement}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{begin\_imd\_measurement()}{begin\_imd\_measurement()}}
{\footnotesize\ttfamily H\+A\+L\+\_\+\+Status\+Type\+Def begin\+\_\+imd\+\_\+measurement (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=301pt]{imd_driver_8c_ac32ede0a3ccf3e67a68ecf2610a5f27a_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=294pt]{imd_driver_8c_ac32ede0a3ccf3e67a68ecf2610a5f27a_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{imd_driver_8c_aebd1c3b62e54f80fde0f344a7544f44f}\label{imd_driver_8c_aebd1c3b62e54f80fde0f344a7544f44f}} 
\index{imdDriver.c@{imdDriver.c}!get\_imd\_measurements@{get\_imd\_measurements}}
\index{get\_imd\_measurements@{get\_imd\_measurements}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{get\_imd\_measurements()}{get\_imd\_measurements()}}
{\footnotesize\ttfamily \mbox{\hyperlink{struct_i_m_d_measurements}{I\+M\+D\+Measurements}} get\+\_\+imd\+\_\+measurements (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{imd_driver_8c_aebd1c3b62e54f80fde0f344a7544f44f_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{imd_driver_8c_a9604fac4bed1c3a28bad1e6be5c7f62c}\label{imd_driver_8c_a9604fac4bed1c3a28bad1e6be5c7f62c}} 
\index{imdDriver.c@{imdDriver.c}!get\_imd\_status@{get\_imd\_status}}
\index{get\_imd\_status@{get\_imd\_status}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{get\_imd\_status()}{get\_imd\_status()}}
{\footnotesize\ttfamily \mbox{\hyperlink{imd_driver_8h_a9f01a176f9de4b760a320dd1a107f598}{I\+M\+D\+Status}} get\+\_\+imd\+\_\+status (\begin{DoxyParamCaption}{ }\end{DoxyParamCaption})}

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=320pt]{imd_driver_8c_a9604fac4bed1c3a28bad1e6be5c7f62c_cgraph}
\end{center}
\end{figure}
Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=308pt]{imd_driver_8c_a9604fac4bed1c3a28bad1e6be5c7f62c_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{imd_driver_8c_a77a2401a35ddd9bd0b8fc28331b81381}\label{imd_driver_8c_a77a2401a35ddd9bd0b8fc28331b81381}} 
\index{imdDriver.c@{imdDriver.c}!HAL\_TIM\_IC\_CaptureCallback@{HAL\_TIM\_IC\_CaptureCallback}}
\index{HAL\_TIM\_IC\_CaptureCallback@{HAL\_TIM\_IC\_CaptureCallback}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{HAL\_TIM\_IC\_CaptureCallback()}{HAL\_TIM\_IC\_CaptureCallback()}}
{\footnotesize\ttfamily void H\+A\+L\+\_\+\+T\+I\+M\+\_\+\+I\+C\+\_\+\+Capture\+Callback (\begin{DoxyParamCaption}\item[{T\+I\+M\+\_\+\+Handle\+Type\+Def $\ast$}]{htim }\end{DoxyParamCaption})}

\mbox{\Hypertarget{imd_driver_8c_a6f3d9bbe5a82521876f77eb2060be41b}\label{imd_driver_8c_a6f3d9bbe5a82521876f77eb2060be41b}} 
\index{imdDriver.c@{imdDriver.c}!init\_imd\_measurement@{init\_imd\_measurement}}
\index{init\_imd\_measurement@{init\_imd\_measurement}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{init\_imd\_measurement()}{init\_imd\_measurement()}}
{\footnotesize\ttfamily H\+A\+L\+\_\+\+Status\+Type\+Def init\+\_\+imd\+\_\+measurement (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=280pt]{imd_driver_8c_a6f3d9bbe5a82521876f77eb2060be41b_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{imd_driver_8c_af1f048b39ad5d1c58fedb14d8b71ceac}\label{imd_driver_8c_af1f048b39ad5d1c58fedb14d8b71ceac}} 
\index{imdDriver.c@{imdDriver.c}!print\_error@{print\_error}}
\index{print\_error@{print\_error}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{print\_error()}{print\_error()}}
{\footnotesize\ttfamily static void print\+\_\+error (\begin{DoxyParamCaption}\item[{char}]{err\mbox{[}$\,$\mbox{]} }\end{DoxyParamCaption})\hspace{0.3cm}{\ttfamily [static]}}

Here is the caller graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{imd_driver_8c_af1f048b39ad5d1c58fedb14d8b71ceac_icgraph}
\end{center}
\end{figure}
\mbox{\Hypertarget{imd_driver_8c_a6d65575764f3cb021f84c20bee19f7ef}\label{imd_driver_8c_a6d65575764f3cb021f84c20bee19f7ef}} 
\index{imdDriver.c@{imdDriver.c}!stop\_imd\_measurement@{stop\_imd\_measurement}}
\index{stop\_imd\_measurement@{stop\_imd\_measurement}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{stop\_imd\_measurement()}{stop\_imd\_measurement()}}
{\footnotesize\ttfamily H\+A\+L\+\_\+\+Status\+Type\+Def stop\+\_\+imd\+\_\+measurement (\begin{DoxyParamCaption}\item[{void}]{ }\end{DoxyParamCaption})}

Here is the call graph for this function\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=297pt]{imd_driver_8c_a6d65575764f3cb021f84c20bee19f7ef_cgraph}
\end{center}
\end{figure}


\doxysubsection{Variable Documentation}
\mbox{\Hypertarget{imd_driver_8c_af81aa17671bf683054a54703a454a1ba}\label{imd_driver_8c_af81aa17671bf683054a54703a454a1ba}} 
\index{imdDriver.c@{imdDriver.c}!lastCaptureTimeTicks@{lastCaptureTimeTicks}}
\index{lastCaptureTimeTicks@{lastCaptureTimeTicks}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{lastCaptureTimeTicks}{lastCaptureTimeTicks}}
{\footnotesize\ttfamily volatile uint32\+\_\+t last\+Capture\+Time\+Ticks = 0}

\mbox{\Hypertarget{imd_driver_8c_a2f62b9d23e2baf44cf78109e27289a22}\label{imd_driver_8c_a2f62b9d23e2baf44cf78109e27289a22}} 
\index{imdDriver.c@{imdDriver.c}!meas\_duty\_cycle@{meas\_duty\_cycle}}
\index{meas\_duty\_cycle@{meas\_duty\_cycle}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{meas\_duty\_cycle}{meas\_duty\_cycle}}
{\footnotesize\ttfamily volatile uint32\+\_\+t meas\+\_\+duty\+\_\+cycle = 0}

\mbox{\Hypertarget{imd_driver_8c_adfbfd73fa35cf39e4b29bf320b58abb7}\label{imd_driver_8c_adfbfd73fa35cf39e4b29bf320b58abb7}} 
\index{imdDriver.c@{imdDriver.c}!meas\_freq\_mHz@{meas\_freq\_mHz}}
\index{meas\_freq\_mHz@{meas\_freq\_mHz}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{meas\_freq\_mHz}{meas\_freq\_mHz}}
{\footnotesize\ttfamily volatile uint32\+\_\+t meas\+\_\+freq\+\_\+m\+Hz = 0}

\mbox{\Hypertarget{imd_driver_8c_aa10b9b26d734a2ce24fac2f5c7540bac}\label{imd_driver_8c_aa10b9b26d734a2ce24fac2f5c7540bac}} 
\index{imdDriver.c@{imdDriver.c}!meas\_IC1\_val@{meas\_IC1\_val}}
\index{meas\_IC1\_val@{meas\_IC1\_val}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{meas\_IC1\_val}{meas\_IC1\_val}}
{\footnotesize\ttfamily volatile uint32\+\_\+t meas\+\_\+\+I\+C1\+\_\+val = 0}

\mbox{\Hypertarget{imd_driver_8c_adff46a5e26f9ece00b19c43e77d737e2}\label{imd_driver_8c_adff46a5e26f9ece00b19c43e77d737e2}} 
\index{imdDriver.c@{imdDriver.c}!meas\_IC2\_val@{meas\_IC2\_val}}
\index{meas\_IC2\_val@{meas\_IC2\_val}!imdDriver.c@{imdDriver.c}}
\doxysubsubsection{\texorpdfstring{meas\_IC2\_val}{meas\_IC2\_val}}
{\footnotesize\ttfamily volatile uint32\+\_\+t meas\+\_\+\+I\+C2\+\_\+val = 0}

