\hypertarget{imd_driver_8c}{}\doxysection{/\+Users/djgood/\+WFE/firmware/2018\+\_\+bmu/\+Src/\+F7\+\_\+\+Src/imd\+Driver.c File Reference}
\label{imd_driver_8c}\index{/Users/djgood/WFE/firmware/2018\_bmu/Src/F7\_Src/imdDriver.c@{/Users/djgood/WFE/firmware/2018\_bmu/Src/F7\_Src/imdDriver.c}}


Module containing functions to read IMD status.  


{\ttfamily \#include \char`\"{}imd\+Driver.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}bsp.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}debug.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}BMU\+\_\+dtc.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}state\+\_\+machine.\+h\char`\"{}}\newline
{\ttfamily \#include \char`\"{}control\+State\+Machine.\+h\char`\"{}}\newline
\doxysubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{imd_driver_8c_a42017d849e45c764948b04484eb8c00b}\label{imd_driver_8c_a42017d849e45c764948b04484eb8c00b}} 
\#define {\bfseries IMD\+\_\+\+SENSE\+\_\+\+PIN\+\_\+\+FAULT}~GPIO\+\_\+\+PIN\+\_\+\+RESET
\item 
\mbox{\Hypertarget{imd_driver_8c_a8f0f5b9d61f1fe2abcb9e93826e14d95}\label{imd_driver_8c_a8f0f5b9d61f1fe2abcb9e93826e14d95}} 
\#define {\bfseries IMD\+\_\+\+SENSE\+\_\+\+PIN\+\_\+\+NO\+\_\+\+FAULT}~GPIO\+\_\+\+PIN\+\_\+\+SET
\item 
\mbox{\Hypertarget{imd_driver_8c_a0a2c7de4cb34f5967b2394c632782abc}\label{imd_driver_8c_a0a2c7de4cb34f5967b2394c632782abc}} 
\#define {\bfseries IMD\+\_\+\+FREQ\+\_\+\+MEAS\+\_\+\+TIMEOUT\+\_\+\+MS}~200
\item 
\mbox{\Hypertarget{imd_driver_8c_ae13157c0dc47d315b5fa8a3e2d874625}\label{imd_driver_8c_ae13157c0dc47d315b5fa8a3e2d874625}} 
\#define {\bfseries IMD\+\_\+\+TIMER\+\_\+\+TICK\+\_\+\+FREQUENCY\+\_\+\+HZ}~50000
\end{DoxyCompactItemize}
\doxysubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{imd_driver_8c_a6f3d9bbe5a82521876f77eb2060be41b}\label{imd_driver_8c_a6f3d9bbe5a82521876f77eb2060be41b}} 
HAL\+\_\+\+Status\+Type\+Def {\bfseries init\+\_\+imd\+\_\+measurement} (void)
\item 
\mbox{\Hypertarget{imd_driver_8c_ac32ede0a3ccf3e67a68ecf2610a5f27a}\label{imd_driver_8c_ac32ede0a3ccf3e67a68ecf2610a5f27a}} 
HAL\+\_\+\+Status\+Type\+Def {\bfseries begin\+\_\+imd\+\_\+measurement} (void)
\item 
\mbox{\Hypertarget{imd_driver_8c_a6d65575764f3cb021f84c20bee19f7ef}\label{imd_driver_8c_a6d65575764f3cb021f84c20bee19f7ef}} 
HAL\+\_\+\+Status\+Type\+Def {\bfseries stop\+\_\+imd\+\_\+measurement} (void)
\item 
\mbox{\Hypertarget{imd_driver_8c_aebd1c3b62e54f80fde0f344a7544f44f}\label{imd_driver_8c_aebd1c3b62e54f80fde0f344a7544f44f}} 
IMDMeasurements {\bfseries get\+\_\+imd\+\_\+measurements} (void)
\item 
\mbox{\Hypertarget{imd_driver_8c_ae7c47b247d60f019398ac13248a4e13d}\label{imd_driver_8c_ae7c47b247d60f019398ac13248a4e13d}} 
IMDStatus {\bfseries \+\_\+imd\+\_\+status} (uint32\+\_\+t freq\+\_\+m\+Hz, uint32\+\_\+t duty)
\item 
\mbox{\Hypertarget{imd_driver_8c_a9604fac4bed1c3a28bad1e6be5c7f62c}\label{imd_driver_8c_a9604fac4bed1c3a28bad1e6be5c7f62c}} 
IMDStatus {\bfseries get\+\_\+imd\+\_\+status} ()
\item 
\mbox{\Hypertarget{imd_driver_8c_a77a2401a35ddd9bd0b8fc28331b81381}\label{imd_driver_8c_a77a2401a35ddd9bd0b8fc28331b81381}} 
void {\bfseries HAL\+\_\+\+TIM\+\_\+\+IC\+\_\+\+Capture\+Callback} (TIM\+\_\+\+Handle\+Type\+Def $\ast$htim)
\end{DoxyCompactItemize}
\doxysubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{imd_driver_8c_adff46a5e26f9ece00b19c43e77d737e2}\label{imd_driver_8c_adff46a5e26f9ece00b19c43e77d737e2}} 
volatile uint32\+\_\+t {\bfseries meas\+\_\+\+IC2\+\_\+val} = 0
\item 
\mbox{\Hypertarget{imd_driver_8c_aa10b9b26d734a2ce24fac2f5c7540bac}\label{imd_driver_8c_aa10b9b26d734a2ce24fac2f5c7540bac}} 
volatile uint32\+\_\+t {\bfseries meas\+\_\+\+IC1\+\_\+val} = 0
\item 
\mbox{\Hypertarget{imd_driver_8c_a2f62b9d23e2baf44cf78109e27289a22}\label{imd_driver_8c_a2f62b9d23e2baf44cf78109e27289a22}} 
volatile uint32\+\_\+t {\bfseries meas\+\_\+duty\+\_\+cycle} = 0
\item 
\mbox{\Hypertarget{imd_driver_8c_adfbfd73fa35cf39e4b29bf320b58abb7}\label{imd_driver_8c_adfbfd73fa35cf39e4b29bf320b58abb7}} 
volatile uint32\+\_\+t {\bfseries meas\+\_\+freq\+\_\+m\+Hz} = 0
\item 
\mbox{\Hypertarget{imd_driver_8c_af81aa17671bf683054a54703a454a1ba}\label{imd_driver_8c_af81aa17671bf683054a54703a454a1ba}} 
volatile uint32\+\_\+t {\bfseries last\+Capture\+Time\+Ticks} = 0
\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Module containing functions to read IMD status. 

\begin{DoxyAuthor}{Author}
Richard Matthews
\end{DoxyAuthor}
The IMD (Bender IR155-\/3203/3204) is an insulation monitoring device which monitors the resistance between the HV Bus and the chassis ground. It reports a fault if the insulation drop below a certain value. The IMD communicates with the BMU through a gpio pin indicating a boolean fault status (OK or FAIL) and a PWM signal indicating the fault type. 