<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BMU: /Users/djgood/WFE/firmware/2018_bmu/Src/prechargeDischarge.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">BMU
   &#160;<span id="projectnumber">2018</span>
   </div>
   <div id="projectbrief">Battery Management Unit</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_413f4e031a85da0d68269c6fd2f76e1c.html">Src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">prechargeDischarge.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Controls the precharge and dishcarge procedures of the HV bus.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;prechargeDischarge.h&quot;</code><br />
<code>#include &quot;controlStateMachine.h&quot;</code><br />
<code>#include &quot;debug.h&quot;</code><br />
<code>#include &quot;FreeRTOS.h&quot;</code><br />
<code>#include &quot;task.h&quot;</code><br />
<code>#include &quot;math.h&quot;</code><br />
<code>#include &quot;BMU_dtc.h&quot;</code><br />
<code>#include &quot;batteries.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a69f54d0032197528845e3c70d2e0bc68"><td class="memItemLeft" align="right" valign="top"><a id="a69f54d0032197528845e3c70d2e0bc68"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>ENABLE_PRECHARGE_DISCHARGE</b></td></tr>
<tr class="separator:a69f54d0032197528845e3c70d2e0bc68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f9b3c758c866184895ab6f267f56f2a"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a8f9b3c758c866184895ab6f267f56f2a">WAIT_FOR_NEXT_MEASURE_OR_STOP</a>(MeasurePeriod,  NotificationOut)</td></tr>
<tr class="memdesc:a8f9b3c758c866184895ab6f267f56f2a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Delay measure period, and interrupt delay if receive notification.  <a href="precharge_discharge_8c.html#a8f9b3c758c866184895ab6f267f56f2a">More...</a><br /></td></tr>
<tr class="separator:a8f9b3c758c866184895ab6f267f56f2a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:a3777552234c99ae105a60e1d276af4a8"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a3777552234c99ae105a60e1d276af4a8">Precharge_Discharge_Return_t</a></td></tr>
<tr class="separator:a3777552234c99ae105a60e1d276af4a8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1819a0ea7cf7fe2cee5bab95287a589a"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69">Precharge_Type_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a1819a0ea7cf7fe2cee5bab95287a589a">Precharge_Type_t</a></td></tr>
<tr class="separator:a1819a0ea7cf7fe2cee5bab95287a589a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dc9cdbf0b2d1b0df080ab3db51ab32f"><td class="memItemLeft" align="right" valign="top">typedef enum <a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a6dc9cdbf0b2d1b0df080ab3db51ab32f">ContactorState_t</a></td></tr>
<tr class="separator:a6dc9cdbf0b2d1b0df080ab3db51ab32f"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:aea79df947f854aa51fdc586c2c8d97f5"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a> { <a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5a9e16b164a3957bef4ef78271f7017d8b">PCDC_DONE</a>
, <a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5a59acc94908f41ef74bec78bba4cb0aa7">PCDC_STOPPED</a>
, <a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5a788f6ccccc3a6334cd4eca279b25ecbc">PCDC_ERROR</a>
 }</td></tr>
<tr class="separator:aea79df947f854aa51fdc586c2c8d97f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17b0022b8742c7c348c6ee58af55fc69"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69">Precharge_Type_t</a> { <a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69ada9b46c1ebd1fbdc6b0ad130e5c1a8da">PC_MotorControllers</a>
, <a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69a6ae49cfd32f4809f78b0f9c95501983f">PC_Charger</a>
, <b>PC_NumTypes</b>
 }</td></tr>
<tr class="separator:a17b0022b8742c7c348c6ee58af55fc69"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a25149a5b048ac873c80edeabc0e1ace7"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a> { <b>CONTACTOR_CLOSED</b> = GPIO_PIN_RESET
, <b>CONTACTOR_OPEN</b> = GPIO_PIN_SET
 }</td></tr>
<tr class="separator:a25149a5b048ac873c80edeabc0e1ace7"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aeb4682e026fd4f795f52338469d54915"><td class="memItemLeft" align="right" valign="top"><a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#aeb4682e026fd4f795f52338469d54915">discharge</a> ()</td></tr>
<tr class="memdesc:aeb4682e026fd4f795f52338469d54915"><td class="mdescLeft">&#160;</td><td class="mdescRight">Discharges HV Bus. Opens contactors which connects in discharge resistor to discharge bus voltage. This function sends out a warning DTC, then waits (with timeout) for bus current to go to zero before opening contactors. This attempts to avoid opening contactors under load which can cause arcing/welding of contactors (very bad).  <a href="precharge_discharge_8c.html#aeb4682e026fd4f795f52338469d54915">More...</a><br /></td></tr>
<tr class="separator:aeb4682e026fd4f795f52338469d54915"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af2d764dbfb0dae00e4d9f8849c80bd7b"><td class="memItemLeft" align="right" valign="top"><a id="af2d764dbfb0dae00e4d9f8849c80bd7b"></a>
HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><b>pcdcInit</b> ()</td></tr>
<tr class="separator:af2d764dbfb0dae00e4d9f8849c80bd7b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abff2f24b02adb053c98e9dab39e4bf8c"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#abff2f24b02adb053c98e9dab39e4bf8c">setNegContactor</a> (<a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a> state)</td></tr>
<tr class="memdesc:abff2f24b02adb053c98e9dab39e4bf8c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control negative contactor.  <a href="precharge_discharge_8c.html#abff2f24b02adb053c98e9dab39e4bf8c">More...</a><br /></td></tr>
<tr class="separator:abff2f24b02adb053c98e9dab39e4bf8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1cf8d9e41ce57c21a0cb0c8c3ed63dbc"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a1cf8d9e41ce57c21a0cb0c8c3ed63dbc">setPosContactor</a> (<a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a> state)</td></tr>
<tr class="memdesc:a1cf8d9e41ce57c21a0cb0c8c3ed63dbc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control positive contactor.  <a href="precharge_discharge_8c.html#a1cf8d9e41ce57c21a0cb0c8c3ed63dbc">More...</a><br /></td></tr>
<tr class="separator:a1cf8d9e41ce57c21a0cb0c8c3ed63dbc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae515fc0cfdab37834fe7288670ee1c9f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#ae515fc0cfdab37834fe7288670ee1c9f">setPrechargeContactor</a> (<a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a> state)</td></tr>
<tr class="memdesc:ae515fc0cfdab37834fe7288670ee1c9f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Control precharge discharge contactor.  <a href="precharge_discharge_8c.html#ae515fc0cfdab37834fe7288670ee1c9f">More...</a><br /></td></tr>
<tr class="separator:ae515fc0cfdab37834fe7288670ee1c9f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a31e37b4f44b11e182256bff5c25df2ac"><td class="memItemLeft" align="right" valign="top"><a id="a31e37b4f44b11e182256bff5c25df2ac"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a31e37b4f44b11e182256bff5c25df2ac">openAllContactors</a> ()</td></tr>
<tr class="memdesc:a31e37b4f44b11e182256bff5c25df2ac"><td class="mdescLeft">&#160;</td><td class="mdescRight">Opens all contactors (safe state) <br /></td></tr>
<tr class="separator:a31e37b4f44b11e182256bff5c25df2ac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af98be4ce700b42b38a9f1126522cbd75"><td class="memItemLeft" align="right" valign="top">HAL_StatusTypeDef&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#af98be4ce700b42b38a9f1126522cbd75">updateMeasurements</a> (float *VBus, float *VBatt, float *IBus)</td></tr>
<tr class="memdesc:af98be4ce700b42b38a9f1126522cbd75"><td class="mdescLeft">&#160;</td><td class="mdescRight">Update HV Bus measurements.  <a href="precharge_discharge_8c.html#af98be4ce700b42b38a9f1126522cbd75">More...</a><br /></td></tr>
<tr class="separator:af98be4ce700b42b38a9f1126522cbd75"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c67d24028b0fc2b67821ea9b0b55144"><td class="memItemLeft" align="right" valign="top"><a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a7c67d24028b0fc2b67821ea9b0b55144">precharge</a> (<a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69">Precharge_Type_t</a> prechargeType)</td></tr>
<tr class="memdesc:a7c67d24028b0fc2b67821ea9b0b55144"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform precharge. If succesful, bus voltage will equal battery voltage.  <a href="precharge_discharge_8c.html#a7c67d24028b0fc2b67821ea9b0b55144">More...</a><br /></td></tr>
<tr class="separator:a7c67d24028b0fc2b67821ea9b0b55144"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65d178f293cd832dab02da08d5e86748"><td class="memItemLeft" align="right" valign="top"><a id="a65d178f293cd832dab02da08d5e86748"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="precharge_discharge_8c.html#a65d178f293cd832dab02da08d5e86748">pcdcTask</a> (void *pvParameter)</td></tr>
<tr class="memdesc:a65d178f293cd832dab02da08d5e86748"><td class="mdescLeft">&#160;</td><td class="mdescRight">Task to control precharge and discharge. Receives notifications from the control state machine to either precharge/discharge or stop precharge. <br /></td></tr>
<tr class="separator:a65d178f293cd832dab02da08d5e86748"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a9586edc6945922e1f2308286e7e0f42f"><td class="memItemLeft" align="right" valign="top"><a id="a9586edc6945922e1f2308286e7e0f42f"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>HITL_Precharge_Mode</b> = false</td></tr>
<tr class="separator:a9586edc6945922e1f2308286e7e0f42f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a86492193b3825205acfee792b46c0f2d"><td class="memItemLeft" align="right" valign="top"><a id="a86492193b3825205acfee792b46c0f2d"></a>
float&#160;</td><td class="memItemRight" valign="bottom"><b>HITL_VPACK</b> = 0</td></tr>
<tr class="separator:a86492193b3825205acfee792b46c0f2d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Controls the precharge and dishcarge procedures of the HV bus. </p>
<dl class="section author"><dt>Author</dt><dd>Richard Matthews</dd></dl>
<p>The precharge and discharge procedure is repsonsible for safely connecting and disconnecting the HV battery pack from the motor controllers. It is controlled by the precharge discharge task (pcdcTask). The main control state machine initiates precharge and discharge by sending a notification to the pcdcTask, and discharge is initiated by the state machine in the case of errors. </p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a id="a8f9b3c758c866184895ab6f267f56f2a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8f9b3c758c866184895ab6f267f56f2a">&#9670;&nbsp;</a></span>WAIT_FOR_NEXT_MEASURE_OR_STOP</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define WAIT_FOR_NEXT_MEASURE_OR_STOP</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">MeasurePeriod, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">NotificationOut&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line">    <span class="keywordflow">do</span> { \</div>
<div class="line">        NotificationOut = 0; <span class="comment">/* Set to zero, in case no notifaction received */</span> \</div>
<div class="line">        xTaskNotifyWait( 0x00,       <span class="comment">/* Don&#39;t clear any notification bits on entry. */</span> \</div>
<div class="line">                         UINT32_MAX, <span class="comment">/* Reset the notification value to 0 on exit. */</span> \</div>
<div class="line">                         &amp;NotificationOut, <span class="comment">/* Notified value passed out */</span> \</div>
<div class="line">                         pdMS_TO_TICKS(MeasurePeriod)); <span class="comment">/* Timeout */</span> \</div>
<div class="line">    } <span class="keywordflow">while</span>(0)</div>
</div><!-- fragment -->
<p>Delay measure period, and interrupt delay if receive notification. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">MeasurePeriod</td><td>The period to delay for </td></tr>
    <tr><td class="paramname">NotificationOut</td><td>The returned notification value </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="a6dc9cdbf0b2d1b0df080ab3db51ab32f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6dc9cdbf0b2d1b0df080ab3db51ab32f">&#9670;&nbsp;</a></span>ContactorState_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a> <a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum to translate between contactor open/closed and GPIO pin state </p>

</div>
</div>
<a id="a3777552234c99ae105a60e1d276af4a8"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3777552234c99ae105a60e1d276af4a8">&#9670;&nbsp;</a></span>Precharge_Discharge_Return_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a> <a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return types for precharge and discharge functions </p>

</div>
</div>
<a id="a1819a0ea7cf7fe2cee5bab95287a589a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1819a0ea7cf7fe2cee5bab95287a589a">&#9670;&nbsp;</a></span>Precharge_Type_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef enum <a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69">Precharge_Type_t</a> <a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69">Precharge_Type_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Type of precharge to perform. This changes the checks performed during precharge, due to different capacitance of motor controllers and chargers. See BMU confluence for more details </p>

</div>
</div>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="a25149a5b048ac873c80edeabc0e1ace7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a25149a5b048ac873c80edeabc0e1ace7">&#9670;&nbsp;</a></span>ContactorState_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Enum to translate between contactor open/closed and GPIO pin state </p>

</div>
</div>
<a id="aea79df947f854aa51fdc586c2c8d97f5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea79df947f854aa51fdc586c2c8d97f5">&#9670;&nbsp;</a></span>Precharge_Discharge_Return_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Return types for precharge and discharge functions </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="aea79df947f854aa51fdc586c2c8d97f5a9e16b164a3957bef4ef78271f7017d8b"></a>PCDC_DONE&#160;</td><td class="fielddoc"><p>Precharge/Discharge completed. </p>
</td></tr>
<tr><td class="fieldname"><a id="aea79df947f854aa51fdc586c2c8d97f5a59acc94908f41ef74bec78bba4cb0aa7"></a>PCDC_STOPPED&#160;</td><td class="fielddoc"><p>Precharge/Discharge stopped succesfully (as requested by task notification) </p>
</td></tr>
<tr><td class="fieldname"><a id="aea79df947f854aa51fdc586c2c8d97f5a788f6ccccc3a6334cd4eca279b25ecbc"></a>PCDC_ERROR&#160;</td><td class="fielddoc"><p>Error occured during Precharge/Discharge. </p>
</td></tr>
</table>

</div>
</div>
<a id="a17b0022b8742c7c348c6ee58af55fc69"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17b0022b8742c7c348c6ee58af55fc69">&#9670;&nbsp;</a></span>Precharge_Type_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69">Precharge_Type_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Type of precharge to perform. This changes the checks performed during precharge, due to different capacitance of motor controllers and chargers. See BMU confluence for more details </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a17b0022b8742c7c348c6ee58af55fc69ada9b46c1ebd1fbdc6b0ad130e5c1a8da"></a>PC_MotorControllers&#160;</td><td class="fielddoc"><p>Precharge motor controllers. </p>
</td></tr>
<tr><td class="fieldname"><a id="a17b0022b8742c7c348c6ee58af55fc69a6ae49cfd32f4809f78b0f9c95501983f"></a>PC_Charger&#160;</td><td class="fielddoc"><p>Precharge charger. </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="aeb4682e026fd4f795f52338469d54915"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aeb4682e026fd4f795f52338469d54915">&#9670;&nbsp;</a></span>discharge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a> discharge </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Discharges HV Bus. Opens contactors which connects in discharge resistor to discharge bus voltage. This function sends out a warning DTC, then waits (with timeout) for bus current to go to zero before opening contactors. This attempts to avoid opening contactors under load which can cause arcing/welding of contactors (very bad). </p>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="precharge_discharge_8c.html#a3777552234c99ae105a60e1d276af4a8">Precharge_Discharge_Return_t</a> </dd></dl>

</div>
</div>
<a id="a7c67d24028b0fc2b67821ea9b0b55144"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c67d24028b0fc2b67821ea9b0b55144">&#9670;&nbsp;</a></span>precharge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="precharge_discharge_8c.html#aea79df947f854aa51fdc586c2c8d97f5">Precharge_Discharge_Return_t</a> precharge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69">Precharge_Type_t</a>&#160;</td>
          <td class="paramname"><em>prechargeType</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform precharge. If succesful, bus voltage will equal battery voltage. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">prechargeType</td><td><a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69ada9b46c1ebd1fbdc6b0ad130e5c1a8da">PC_MotorControllers</a> precharges into motor controllers, so assumes a high capacitance and therefore precharge current. <a class="el" href="precharge_discharge_8c.html#a17b0022b8742c7c348c6ee58af55fc69a6ae49cfd32f4809f78b0f9c95501983f">PC_Charger</a> precharges into the charger, so assumes a low capacitance and therefore negligible current</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd><a class="el" href="precharge_discharge_8c.html#a3777552234c99ae105a60e1d276af4a8">Precharge_Discharge_Return_t</a> </dd></dl>

</div>
</div>
<a id="abff2f24b02adb053c98e9dab39e4bf8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#abff2f24b02adb053c98e9dab39e4bf8c">&#9670;&nbsp;</a></span>setNegContactor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setNegContactor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a>&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Control negative contactor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>The state to set contactor to </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a1cf8d9e41ce57c21a0cb0c8c3ed63dbc"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1cf8d9e41ce57c21a0cb0c8c3ed63dbc">&#9670;&nbsp;</a></span>setPosContactor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setPosContactor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a>&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Control positive contactor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>The state to set contactor to </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ae515fc0cfdab37834fe7288670ee1c9f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ae515fc0cfdab37834fe7288670ee1c9f">&#9670;&nbsp;</a></span>setPrechargeContactor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setPrechargeContactor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="precharge_discharge_8c.html#a25149a5b048ac873c80edeabc0e1ace7">ContactorState_t</a>&#160;</td>
          <td class="paramname"><em>state</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Control precharge discharge contactor. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">state</td><td>The state to set contactor to. Note for PCDC contactor closed means precharge mode, open means discharge mode </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="af98be4ce700b42b38a9f1126522cbd75"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af98be4ce700b42b38a9f1126522cbd75">&#9670;&nbsp;</a></span>updateMeasurements()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">HAL_StatusTypeDef updateMeasurements </td>
          <td>(</td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>VBus</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>VBatt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>IBus</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Update HV Bus measurements. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[out]</td><td class="paramname">VBus</td><td>pointer to float to store HV Bus voltage measurement in volts </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">VBatt</td><td>pointer to float to store HV Battery voltage measurement in volts </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">IBus</td><td>pointer to float to store HV Bus current measurement in amps</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>HAL_StatusTypeDef </dd></dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
